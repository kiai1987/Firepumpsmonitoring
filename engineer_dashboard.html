<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
    function checkAuthentication() {
        if (localStorage.getItem("authenticated") !== "true") {
            window.location.href = "index.html";
        } else {
            document.body.style.display = "flex";
        }
    }

    function logout() {
        localStorage.removeItem("authenticated");
        window.location.href = "index.html";
    }

    window.onload = checkAuthentication;

    let isConnected = false;

    const options = {
        clientId: `mqttjs_${Math.random().toString(16).substr(2, 8)}`,
        username: 'shortjaguar328',
        password: 'GkPMFUvImx2PSXwZ',
    };

    // Change the URL to wss and ensure the port is correct for WSS
    const mqttClient = mqtt.connect('wss://shortjaguar328.cloud.shiftr.io:8883', options);

    mqttClient.on('connect', function () {
        console.log('Connected to MQTT broker');
        isConnected = true;
        mqttClient.subscribe('fire-pump/status', function (err) {
            if (!err) {
                console.log('Subscribed to fire-pump/status');
            }
        });
    });

    mqttClient.on('message', function (topic, message) {
        if (topic === 'fire-pump/status') {
            const data = JSON.parse(message.toString());
            console.log('Received data:', data);
            // Further data handling code here
        }
    });

    mqttClient.on('error', function (error) {
        console.error('MQTT error:', error);
        isConnected = false;
    });
</script>
