<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire Pump Monitoring Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f8f8;
            margin: 0;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .dashboard-section {
            flex: 1;
            min-width: 300px;
            background: #f0f0f0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .dashboard-section h2 {
            margin-bottom: 20px;
        }

        .dashboard-section p {
            font-size: 18px;
            margin: 10px 0;
        }

        .connection-info {
            flex-basis: 100%;
            background: #004d40;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .connection-info p {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .dashboard-section {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-section">
            <h2>Jockey Pump</h2>
            <p>Run: <span id="jp-run">N/A</span></p>
            <p>Trip: <span id="jp-trip">N/A</span></p>
            <p>Mode: <span id="jp-mode">N/A</span></p>
        </div>
        <div class="dashboard-section">
            <h2>Main Pump</h2>
            <p>Run: <span id="mp-run">N/A</span></p>
            <p>Trip: <span id="mp-trip">N/A</span></p>
            <p>Mode: <span id="mp-mode">N/A</span></p>
        </div>
        <div class="dashboard-section">
            <h2>Diesel Pump</h2>
            <p>Run: <span id="dp-run">N/A</span></p>
            <p>Trip: <span id="dp-trip">N/A</span></p>
            <p>Mode: <span id="dp-mode">N/A</span></p>
        </div>
        <div class="dashboard-section">
            <h2>Sensors</h2>
            <p>Smoke Detector 1: <span id="ss1">N/A</span></p>
            <p>Smoke Detector 2: <span id="ss2">N/A</span></p>
            <p>Flood Sensor: <span id="fs">N/A</span></p>
        </div>
        <div class="dashboard-section">
            <h2>Environmental Data</h2>
            <p>Temperature: <span id="temp">N/A</span> Â°C</p>
            <p>Humidity: <span id="hum">N/A</span> %</p>
            <p>Water Pressure: <span id="wp">N/A</span></p>
        </div>
        <div class="connection-info">
            <p>Network Status: <span id="network-status">N/A</span></p>
            <p>IP Address: <span id="ip-address">N/A</span></p>
            <p>LoRa Connection: <span id="lora-connection">N/A</span></p>
            <p>MQTT Connection: <span id="mqtt-connection">N/A</span></p>
        </div>
    </div>

    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
        const broker = "wss://f2ab9bfaba074ec09d314fd0d5aedfd8.s1.eu.hivemq.cloud:8884/mqtt";
        const clientId = "web_" + Math.random().toString(16).substr(2, 8);
        const options = {
            keepalive: 60,
            clientId: clientId,
            username: "firepump",
            password: "044313187Ki@",
            protocolId: 'MQTT',
            protocolVersion: 4,
            clean: true,
            reconnectPeriod: 1000,
            connectTimeout: 30 * 1000
        };

        const client = mqtt.connect(broker, options);

        client.on('connect', () => {
            console.log('Connected to MQTT broker');
            client.subscribe('fire-pump/status');
            document.getElementById('mqtt-connection').innerText = 'Connected';
        });

        client.on('message', (topic, message) => {
            console.log('Received message:', topic, message.toString());
            const data = JSON.parse(message.toString());

            document.getElementById('jp-run').innerText = data.JP ? 'Running' : 'Stopped';
            document.getElementById('jp-trip').innerText = data.JPT ? 'Tripped' : 'Normal';
            document.getElementById('jp-mode').innerText = data.JPM === 1 ? 'Manual' : data.JPM === 2 ? 'Auto' : 'Unknown';

            document.getElementById('mp-run').innerText = data.MP ? 'Running' : 'Stopped';
            document.getElementById('mp-trip').innerText = data.MPT ? 'Tripped' : 'Normal';
            document.getElementById('mp-mode').innerText = data.MPM === 1 ? 'Manual' : data.MPM === 2 ? 'Auto' : 'Unknown';

            document.getElementById('dp-run').innerText = data.DP ? 'Running' : 'Stopped';
            document.getElementById('dp-trip').innerText = data.DPT ? 'Tripped' : 'Normal';
            document.getElementById('dp-mode').innerText = data.DPM === 1 ? 'Manual' : data.DPM === 2 ? 'Auto' : 'Unknown';

            document.getElementById('ss1').innerText = data.SS1 ? 'Active' : 'Inactive';
            document.getElementById('ss2').innerText = data.SS2 ? 'Active' : 'Inactive';
            document.getElementById('fs').innerText = data.FS ? 'Detected' : 'Not Detected';

            document.getElementById('temp').innerText = data.TH.split(',')[0];
            document.getElementById('hum').innerText = data.TH.split(',')[1];
            document.getElementById('wp').innerText = data.WP;

            document.getElementById('network-status').innerText = data.networkStatus;
            document.getElementById('ip-address').innerText = data.ipAddress;
            document.getElementById('lora-connection').innerText = data.RXTX ? 'Connected' : 'Disconnected';
        });

        client.on('reconnect', () => {
            console.log('Reconnecting...');
            document.getElementById('mqtt-connection').innerText = 'Reconnecting...';
        });

        client.on('offline', () => {
            console.log('MQTT client offline');
            document.getElementById('mqtt-connection').innerText = 'Offline';
        });

        client.on('error', (err) => {
            console.error('Connection error:', err);
            document.getElementById('mqtt-connection').innerText = 'Error';
        });
    </script>
</body>
</html>
